<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emily Chen - Student Detail</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="../shared/wireframe-base.css" />
    <style>
      /* ============================================
         PAGE-SPECIFIC STYLES: Student Detail Overview
         ============================================ */

      /* Pre-Lesson Context Card */
      .prelesson-card {
        background: linear-gradient(135deg, var(--primary-50) 0%, var(--bg-surface) 100%);
        border: 1px solid var(--primary-200);
        border-radius: var(--radius-lg);
        margin-bottom: var(--space-6);
        box-shadow: var(--shadow-sm);
      }

      .prelesson-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-4) var(--space-5);
        border-bottom: 1px solid var(--primary-100);
      }

      .prelesson-title {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: 14px;
        font-weight: 600;
        color: var(--primary-700);
      }

      .prelesson-title i {
        font-size: 18px;
        color: var(--primary-500);
      }

      .prelesson-content {
        padding: var(--space-4) var(--space-5);
      }

      .prelesson-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-4);
      }

      .prelesson-item {
        display: flex;
        flex-direction: column;
        gap: var(--space-1);
      }

      .prelesson-label {
        font-size: 11px;
        font-weight: 600;
        color: var(--fg-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .prelesson-value {
        font-size: 14px;
        color: var(--fg-secondary);
        line-height: 1.5;
      }

      /* Guardian Cards */
      .guardian-card {
        background: var(--bg-subtle);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        margin-bottom: var(--space-3);
        transition: all var(--transition-fast);
        position: relative;
      }

      .guardian-card--primary {
        background: var(--primary-50);
        border: 1px solid var(--primary-200);
      }

      .guardian-header {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: var(--space-2);
        margin-bottom: var(--space-2);
      }

      .guardian-name {
        font-size: 15px;
        font-weight: 600;
        color: var(--fg-default);
      }

      .guardian-role {
        font-size: 12px;
        color: var(--fg-muted);
      }

      .guardian-contact {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        font-size: 13px;
        color: var(--fg-secondary);
      }

      .guardian-contact i {
        color: var(--fg-muted);
        margin-right: 4px;
      }

      .guardian-contact a {
        color: var(--primary-600);
        text-decoration: none;
      }

      .guardian-contact a:hover {
        text-decoration: underline;
      }

      .guardian-address {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: 13px;
        color: var(--fg-secondary);
      }

      .guardian-address i {
        color: var(--fg-muted);
      }

      .guardian-actions {
        position: absolute;
        top: var(--space-4);
        right: var(--space-4);
        display: flex;
        gap: var(--space-1);
      }

      .guardian-action-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: var(--radius-md);
        background: var(--bg-surface);
        border: 1px solid var(--border-default);
        color: var(--fg-muted);
        cursor: pointer;
        transition: all var(--transition-fast);
      }

      .guardian-action-btn:hover {
        background: var(--primary-50);
        border-color: var(--primary-200);
        color: var(--primary-600);
      }

      /* Contact Menu */
      .contact-menu-wrapper {
        position: relative;
        margin-left: auto;
      }

      .contact-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: var(--radius-sm);
        background: transparent;
        border: none;
        color: var(--fg-muted);
        cursor: pointer;
        transition: all var(--transition-fast);
      }

      .contact-menu-btn:hover {
        background: var(--bg-subtle);
        color: var(--fg-default);
      }

      .contact-menu {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: var(--space-1);
        background: var(--bg-surface);
        border: 1px solid var(--border-strong);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        min-width: 200px;
        z-index: 100;
        display: none;
      }

      .contact-menu.active {
        display: block;
      }

      .contact-menu-item {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
        font-size: 13px;
        color: var(--fg-secondary);
        cursor: pointer;
        transition: background var(--transition-fast);
      }

      .contact-menu-item:hover {
        background: var(--bg-subtle);
      }

      .contact-menu-item--danger {
        color: var(--danger-600);
      }

      .contact-menu-item--danger:hover {
        background: var(--danger-50);
      }

      .contact-menu-divider {
        height: 1px;
        background: var(--border-default);
        margin: var(--space-1) 0;
      }

      /* Emergency Contact Badge */
      .emergency-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 11px;
        font-weight: 500;
        color: var(--danger-600);
        background: var(--danger-50);
        padding: 2px 8px;
        border-radius: 999px;
        margin-left: var(--space-2);
      }

      /* Add Contact Button */
      .add-contact-btn {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-top: var(--space-4);
        padding: var(--space-3) var(--space-4);
        background: var(--bg-subtle);
        border: 1px dashed var(--border-strong);
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 500;
        color: var(--fg-secondary);
        cursor: pointer;
        transition: all var(--transition-fast);
        width: 100%;
        justify-content: center;
      }

      .add-contact-btn:hover {
        background: var(--primary-50);
        border-color: var(--primary-200);
        color: var(--primary-600);
      }

      .add-contact-btn i {
        font-size: 16px;
        color: var(--primary-600);
      }

      /* Address same-as note */
      .address-note {
        font-size: 12px;
        color: var(--fg-muted);
        font-style: italic;
      }

      /* Address & Siblings */
      .siblings-section {
        margin-top: var(--space-4);
        padding-top: var(--space-4);
        border-top: 1px solid var(--border-default);
      }

      .siblings-title {
        font-size: 11px;
        font-weight: 600;
        color: var(--fg-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: var(--space-3);
      }

      .sibling-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-2) 0;
      }

      .sibling-name {
        font-size: 13px;
        font-weight: 500;
        color: var(--primary-600);
        text-decoration: none;
      }

      .sibling-name:hover {
        text-decoration: underline;
      }

      /* Notes Section */
      .quick-add-note {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-2);
        margin-bottom: var(--space-4);
        padding-bottom: var(--space-4);
        border-bottom: 1px solid var(--border-default);
      }

      .quick-add-input {
        width: 100%;
        padding: var(--space-2) var(--space-3);
        border: 1px solid var(--border-strong);
        border-radius: var(--radius-md);
        font-size: 14px;
        font-family: inherit;
        color: var(--fg-default);
        background: var(--bg-surface);
        transition: border-color var(--transition-fast), box-shadow var(--transition-fast), min-height var(--transition-fast);
        resize: none;
        overflow: hidden;
        min-height: 38px;
        line-height: 1.5;
      }

      .quick-add-input:focus {
        outline: none;
        border-color: var(--primary-500);
        box-shadow: 0 0 0 3px var(--primary-50);
        min-height: 80px;
        overflow: auto;
      }

      .quick-add-input::placeholder {
        color: var(--fg-faint);
      }

      .quick-add-actions {
        display: flex;
        justify-content: flex-end;
        gap: var(--space-2);
        margin-top: var(--space-2);
        opacity: 0;
        max-height: 0;
        overflow: hidden;
        transition: opacity var(--transition-fast), max-height var(--transition-fast);
      }

      .quick-add-note:focus-within .quick-add-actions {
        opacity: 1;
        max-height: 40px;
      }

      /* Pinned Note */
      .pinned-note {
        background: var(--primary-50);
        border: 1px solid var(--primary-200);
        border-radius: var(--radius-md);
        padding: var(--space-4);
        margin-bottom: var(--space-4);
        position: relative;
      }

      .pinned-note-header {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-bottom: var(--space-2);
      }

      .pinned-note-label {
        display: flex;
        align-items: center;
        gap: var(--space-1);
        font-size: 11px;
        font-weight: 600;
        color: var(--primary-600);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .pinned-note-label i {
        font-size: 12px;
      }

      .pinned-note-content {
        font-size: 14px;
        color: var(--fg-default);
        line-height: 1.6;
      }

      .pinned-note-actions {
        position: absolute;
        top: var(--space-3);
        right: var(--space-3);
        display: flex;
        gap: var(--space-1);
        opacity: 0;
        transition: opacity var(--transition-fast);
      }

      .pinned-note:hover .pinned-note-actions {
        opacity: 1;
      }

      .note-action-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        border-radius: var(--radius-sm);
        background: var(--bg-surface);
        border: 1px solid var(--border-default);
        color: var(--fg-muted);
        cursor: pointer;
        transition: all var(--transition-fast);
      }

      .note-action-btn:hover {
        background: var(--bg-subtle);
        color: var(--fg-default);
      }

      .note-action-btn--danger:hover {
        background: var(--danger-50);
        color: var(--danger-600);
        border-color: var(--danger-200);
      }

      /* Notes List */
      .notes-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
      }

      .notes-list-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--space-2);
      }

      .notes-list-title {
        font-size: 11px;
        font-weight: 600;
        color: var(--fg-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .note-entry {
        background: var(--bg-subtle);
        border-radius: var(--radius-md);
        padding: var(--space-3) var(--space-4);
        position: relative;
        transition: background var(--transition-fast);
      }

      .note-entry:hover {
        background: var(--bg-muted);
      }

      .note-entry-content {
        font-size: 14px;
        color: var(--fg-secondary);
        line-height: 1.6;
        padding-right: var(--space-8);
      }

      .note-entry-meta {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-top: var(--space-2);
        font-size: 12px;
        color: var(--fg-faint);
      }

      .note-entry-actions {
        position: absolute;
        top: var(--space-3);
        right: var(--space-3);
        display: flex;
        gap: var(--space-1);
        opacity: 0;
        transition: opacity var(--transition-fast);
      }

      .note-entry:hover .note-entry-actions {
        opacity: 1;
      }

      .show-all-notes {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-1);
        padding: var(--space-2);
        font-size: 13px;
        font-weight: 500;
        color: var(--primary-600);
        background: transparent;
        border: none;
        cursor: pointer;
        transition: color var(--transition-fast);
      }

      .show-all-notes:hover {
        color: var(--primary-700);
        text-decoration: underline;
      }

      /* Billing Summary - Compact */
      .billing-compact {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        font-size: 14px;
      }

      .billing-compact-item {
        display: flex;
        align-items: center;
        gap: var(--space-2);
      }

      .billing-compact-label {
        color: var(--fg-muted);
      }

      .billing-compact-value {
        font-weight: 600;
        color: var(--fg-default);
      }

      .billing-compact-value.positive {
        color: var(--success-600);
      }

      .billing-compact-value.negative {
        color: var(--error-600);
      }

      /* Recent Lessons Table */
      .lessons-table {
        width: 100%;
        border-collapse: collapse;
      }

      .lessons-table th {
        text-align: left;
        padding: var(--space-2) var(--space-3);
        font-size: 11px;
        font-weight: 600;
        color: var(--fg-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        border-bottom: 1px solid var(--border-default);
      }

      .lessons-table td {
        padding: var(--space-4) var(--space-3);
        font-size: 13px;
        color: var(--fg-secondary);
        border-bottom: 1px solid var(--border-default);
        vertical-align: middle;
      }

      .lessons-table tr:last-child td {
        border-bottom: none;
      }

      .lesson-note {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: var(--fg-muted);
        font-size: 12px;
      }

      /* Notification List */
      .notification-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .prelesson-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .prelesson-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- Wireframe Demo Controls -->
    <div class="demo-controls" style="position: fixed; top: 16px; right: 16px; z-index: 1000; background: var(--bg-default); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--space-3) var(--space-4); box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
      <label style="display: flex; align-items: center; gap: var(--space-2); font-size: 13px; color: var(--fg-secondary); cursor: pointer;">
        <input type="checkbox" id="adultStudentToggle" onchange="toggleStudentType()" />
        <span>Adult Student View</span>
      </label>
    </div>

    <div class="app-layout">
      <!-- Sidebar Navigation -->
      <aside class="sidebar" role="navigation" aria-label="Main navigation">
        <div class="sidebar-logo">TutorStudio</div>
        <nav class="sidebar-nav">
          <a href="#" class="nav-item">
            <i class="ph ph-squares-four nav-icon"></i>
            Dashboard
          </a>
          <a href="student-list.html" class="nav-item active">
            <i class="ph ph-users nav-icon"></i>
            Students
          </a>
          <a href="#" class="nav-item">
            <i class="ph ph-calendar nav-icon"></i>
            Calendar
          </a>
          <a href="#" class="nav-item">
            <i class="ph ph-file-text nav-icon"></i>
            Invoices
          </a>
          <a href="#" class="nav-item">
            <i class="ph ph-gear nav-icon"></i>
            Settings
          </a>
        </nav>
        <div class="sidebar-footer">
          <div class="user-info">
            <div class="user-avatar">SJ</div>
            <div>
              <div class="user-name">Sarah Johnson</div>
              <div class="user-email">sarah@example.com</div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Breadcrumb -->
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <ol class="breadcrumb-list">
            <li><a href="student-list.html" class="breadcrumb-link">Students</a></li>
            <li class="breadcrumb-separator">/</li>
            <li class="breadcrumb-current">Emily Chen</li>
          </ol>
        </nav>

        <!-- Student Header -->
        <header class="student-header">
          <div class="student-header-content">
            <div class="student-identity">
              <div class="student-avatar">EC</div>
              <div class="student-info">
                <div class="student-name-row">
                  <h1 class="student-name">Emily Chen</h1>
                  <div class="next-lesson-badge">
                    <i class="ph ph-calendar"></i>
                    Tomorrow at 3:00 PM
                  </div>
                </div>
                <div class="student-badges">
                  <span class="badge badge-type">Child</span>
                  <span class="badge badge-active">Active</span>
                </div>
                <div class="student-meta">
                  <span class="meta-item">
                    <i class="ph ph-envelope"></i>
                    <a href="mailto:emily@example.com" class="meta-link">emily@example.com</a>
                  </span>
                  <span class="meta-item">
                    <i class="ph ph-phone"></i>
                    <a href="tel:+15551234567" class="meta-link">(555) 123-4567</a>
                    <i class="ph ph-chat-circle" title="SMS Capable" style="color: var(--primary-500);"></i>
                  </span>
                  <span class="meta-divider"></span>
                  <span class="student-family">
                    <i class="ph ph-house"></i>
                    Mother: <a href="#" class="family-link">Jennifer Chen</a>
                  </span>
                  <span class="meta-divider"></span>
                  <span class="relationship-duration">Teaching since Sep 2024 (4 months)</span>
                </div>
              </div>
            </div>
            <div class="header-actions">
              <button class="btn btn-primary">
                <i class="ph ph-calendar-plus"></i>
                Schedule Lesson
              </button>
              <div class="dropdown">
                <button class="btn btn-secondary btn-icon" onclick="toggleActionsMenu()">
                  <i class="ph ph-dots-three-outline-vertical"></i>
                </button>
                <div class="dropdown-menu" id="actionsMenu">
                  <div class="dropdown-item">
                    <i class="ph ph-paper-plane-tilt"></i>
                    Send Message
                  </div>
                  <div class="dropdown-item" onclick="editStudent()">
                    <i class="ph ph-pencil"></i>
                    Edit Student
                  </div>
                  <div class="dropdown-item">
                    <i class="ph ph-swap"></i>
                    Change Status
                  </div>
                  <div class="dropdown-divider"></div>
                  <div class="dropdown-item">
                    <i class="ph ph-archive"></i>
                    Archive Student
                  </div>
                  <div class="dropdown-item danger">
                    <i class="ph ph-trash"></i>
                    Delete Student
                  </div>
                </div>
              </div>
            </div>
          </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav" role="tablist">
          <a href="student-detail.html" class="tab-link active" role="tab" aria-selected="true">Overview</a>
          <a href="student-detail-lessons.html" class="tab-link" role="tab">Lessons</a>
          <a href="student-detail-homework.html" class="tab-link" role="tab">Homework</a>
          <a href="student-detail-messages.html" class="tab-link" role="tab">Messages</a>
          <a href="student-detail-invoices.html" class="tab-link" role="tab">Billing & Invoices</a>
          <a href="student-detail-transactions.html" class="tab-link" role="tab">Transactions</a>
          <a href="student-detail-files.html" class="tab-link" role="tab">Files</a>
        </nav>

        <!-- Tab Content: Overview -->
        <div class="tab-content">
          <!-- Pre-Lesson Context -->
          <div class="prelesson-card">
            <div class="prelesson-header">
              <div class="prelesson-title">
                <i class="ph ph-lightbulb"></i>
                Preparing for Tomorrow's Lesson
              </div>
              <button class="btn btn-ghost" onclick="togglePrelesson()">
                <i class="ph ph-caret-up"></i>
              </button>
            </div>
            <div class="prelesson-content" id="prelessonContent">
              <div class="prelesson-grid">
                <div class="prelesson-item">
                  <span class="prelesson-label">Last Lesson</span>
                  <span class="prelesson-value">Jan 6 - Chopin Nocturne Op. 9 No. 2</span>
                </div>
                <div class="prelesson-item">
                  <span class="prelesson-label">Homework Status</span>
                  <span class="prelesson-value">Practice measures 24-48 (assigned)</span>
                </div>
                <div class="prelesson-item">
                  <span class="prelesson-label">Recent Note</span>
                  <span class="prelesson-value">Making great progress on dynamics</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Lesson Settings Section (Primary) -->
          <section class="section-card section-card--primary" id="lessonSettingsSection">
            <div class="section-header">
              <h2 class="section-title">Lesson Settings</h2>
              <button class="btn btn-ghost" onclick="toggleEdit('lessonSettingsSection')">
                <i class="ph ph-pencil"></i>
                Edit
              </button>
            </div>
            <div class="section-content">
              <div class="view-mode">
                <div class="data-grid">
                  <div class="data-item">
                    <span class="data-label">Subjects</span>
                    <span class="data-value">
                      <div class="tag-list">
                        <span class="tag tag-outline">Piano</span>
                        <span class="tag tag-outline">Music Theory</span>
                      </div>
                    </span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Default Duration</span>
                    <span class="data-value">30 minutes</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Lesson Category</span>
                    <span class="data-value">Individual</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Skill Level</span>
                    <span class="data-value">Advanced</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Tags</span>
                    <span class="data-value">
                      <div class="tag-list">
                        <span class="tag tag-purple">Competition Ready</span>
                        <span class="tag tag-teal">Advanced Theory</span>
                      </div>
                    </span>
                  </div>
                </div>
              </div>

              <div class="edit-form">
                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">Subjects</label>
                    <div class="tags-input-wrapper" onclick="this.querySelector('input').focus()">
                      <span class="tag tag-outline">Piano<button class="tag-remove" type="button">&times;</button></span>
                      <span class="tag tag-outline">Music Theory<button class="tag-remove" type="button">&times;</button></span>
                      <input type="text" placeholder="Add subject..." />
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Default Duration <span class="required">*</span></label>
                    <select class="form-select">
                      <option value="30" selected>30 minutes</option>
                      <option value="45">45 minutes</option>
                      <option value="60">60 minutes</option>
                      <option value="90">90 minutes</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Lesson Category <span class="required">*</span></label>
                    <select class="form-select">
                      <option value="individual" selected>Individual</option>
                      <option value="group">Group</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Skill Level</label>
                    <select class="form-select">
                      <option value="beginner">Beginner</option>
                      <option value="intermediate">Intermediate</option>
                      <option value="advanced" selected>Advanced</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Tags</label>
                    <div class="tags-input-wrapper" onclick="this.querySelector('input').focus()">
                      <span class="tag tag-purple">Competition Ready<button class="tag-remove" type="button">&times;</button></span>
                      <span class="tag tag-teal">Advanced Theory<button class="tag-remove" type="button">&times;</button></span>
                      <input type="text" placeholder="Add tag..." />
                    </div>
                  </div>
                </div>
                <div class="form-actions">
                  <button class="btn btn-secondary" onclick="cancelEdit('lessonSettingsSection')">Cancel</button>
                  <button class="btn btn-primary" onclick="saveEdit('lessonSettingsSection')">Save Changes</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Contact & Notifications Section (Secondary) -->
          <section class="section-card section-card--secondary" id="contactSection">
            <div class="section-header">
              <h2 class="section-title">Contact & Notifications</h2>
              <button class="btn btn-ghost" onclick="toggleEdit('contactSection')">
                <i class="ph ph-pencil"></i>
                Edit
              </button>
            </div>
            <div class="section-content">
              <div class="view-mode">
                <div class="data-grid data-grid--2col">
                  <div class="data-item">
                    <span class="data-label">Email</span>
                    <span class="data-value"><a href="mailto:emily@example.com">emily@example.com</a></span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Phone</span>
                    <span class="data-value"><a href="tel:+15551234567">(555) 123-4567</a></span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">SMS Capable</span>
                    <span class="data-value">Yes</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Last Contacted</span>
                    <span class="data-value">3 days ago</span>
                  </div>
                  <!-- Address fields shown for Adult students only -->
                  <div class="data-item full-width adult-only" style="display: none;">
                    <span class="data-label">Address</span>
                    <span class="data-value">456 Maple Ave, San Francisco, CA 94103</span>
                  </div>
                </div>
                <div class="notification-list" style="margin-top: var(--space-4);">
                  <div class="switch-wrapper">
                    <div class="switch active" onclick="this.classList.toggle('active')"></div>
                    <span class="switch-label">Send email lesson reminders</span>
                  </div>
                  <div class="switch-wrapper">
                    <div class="switch active" onclick="this.classList.toggle('active')"></div>
                    <span class="switch-label">Send SMS lesson reminders</span>
                  </div>
                </div>
              </div>

              <div class="edit-form">
                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" value="emily@example.com" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="tel" class="form-input" value="(555) 123-4567" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">SMS Capable</label>
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox" checked />
                      <span>This phone can receive SMS</span>
                    </label>
                  </div>
                </div>

                <!-- Address fields shown for Adult students only -->
                <div class="adult-only" style="display: none;">
                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Address</h5>
                  <div class="form-grid">
                    <div class="form-group full-width">
                      <label class="form-label">Street Address</label>
                      <input type="text" class="form-input" value="456 Maple Ave" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">City</label>
                      <input type="text" class="form-input" value="San Francisco" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">State</label>
                      <select class="form-select">
                        <option value="CA" selected>California</option>
                        <option value="NY">New York</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Zip Code</label>
                      <input type="text" class="form-input" value="94103" />
                    </div>
                  </div>
                </div>

                <div class="notification-list" style="margin-top: var(--space-4);">
                  <div class="switch-wrapper">
                    <div class="switch active" onclick="this.classList.toggle('active')"></div>
                    <span class="switch-label">Send email lesson reminders</span>
                  </div>
                  <div class="switch-wrapper">
                    <div class="switch active" onclick="this.classList.toggle('active')"></div>
                    <span class="switch-label">Send SMS lesson reminders</span>
                  </div>
                </div>
                <div class="form-actions">
                  <button class="btn btn-secondary" onclick="cancelEdit('contactSection')">Cancel</button>
                  <button class="btn btn-primary" onclick="saveEdit('contactSection')">Save Changes</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Family Section (Secondary) -->
          <section class="section-card section-card--secondary" id="familySection">
            <div class="section-header">
              <h2 class="section-title">Family</h2>
            </div>
            <div class="section-content">
              <!-- Primary Contact -->
              <div class="guardian-card guardian-card--primary" id="contact-jennifer">
                <div class="contact-view-mode">
                  <div class="guardian-header">
                    <span class="guardian-name">Mrs. Jennifer Chen</span>
                    <span class="guardian-role" style="margin-left: var(--space-3);">Primary Contact · Mother</span>
                    <span class="emergency-badge">
                      <i class="ph ph-first-aid-kit"></i>
                      Emergency
                    </span>
                    <button class="btn btn-ghost btn-sm" onclick="toggleContactEdit('contact-jennifer')" style="margin-left: auto;">
                      <i class="ph ph-pencil"></i>
                      Edit
                    </button>
                  </div>
                  <div class="guardian-contact">
                    <span>
                      <i class="ph ph-envelope"></i>
                      <a href="mailto:jennifer.chen@example.com">jennifer.chen@example.com</a>
                    </span>
                  </div>
                  <!-- Primary phone number (Mobile preferred, else Home) -->
                  <div class="guardian-phone-primary" style="display: flex; align-items: center; gap: var(--space-2); margin-top: var(--space-2); font-size: 13px; color: var(--fg-secondary);">
                    <i class="ph ph-device-mobile" style="color: var(--fg-muted);"></i>
                    <a href="tel:+15559876543" style="color: var(--primary-600); text-decoration: none;">(555) 987-6543</a>
                    <span style="font-size: 11px; color: var(--fg-muted);">Mobile</span>
                    <i class="ph ph-chat-circle" title="SMS Capable" style="color: var(--primary-500); font-size: 14px;"></i>
                  </div>
                  <div class="guardian-details-toggle" style="margin-top: var(--space-3);">
                    <button class="btn-link" onclick="toggleContactDetails('contact-jennifer')" style="background: none; border: none; padding: 0; font-size: 12px; color: var(--primary-600); cursor: pointer; display: flex; align-items: center; gap: var(--space-1);">
                      <i class="ph ph-caret-right details-caret" style="transition: transform var(--transition-fast);"></i>
                      <span class="details-label">Show details</span>
                    </button>
                  </div>
                  <div class="guardian-details" style="display: none; margin-top: var(--space-3); padding-top: var(--space-3); border-top: 1px solid var(--border-default);">
                    <!-- Additional phone numbers -->
                    <div class="guardian-phone-list" style="display: flex; flex-direction: column; gap: var(--space-2); margin-bottom: var(--space-3);">
                      <span class="guardian-phone-item" style="display: flex; align-items: center; gap: var(--space-2); font-size: 13px; color: var(--fg-secondary);">
                        <i class="ph ph-house" style="color: var(--fg-muted);"></i>
                        <a href="tel:+15551234567" style="color: var(--primary-600); text-decoration: none;">(555) 123-4567</a>
                        <span style="font-size: 11px; color: var(--fg-muted);">Home</span>
                      </span>
                      <span class="guardian-phone-item" style="display: flex; align-items: center; gap: var(--space-2); font-size: 13px; color: var(--fg-secondary);">
                        <i class="ph ph-briefcase" style="color: var(--fg-muted);"></i>
                        <a href="tel:+15559998888" style="color: var(--primary-600); text-decoration: none;">(555) 999-8888</a>
                        <span style="font-size: 11px; color: var(--fg-muted);">Work</span>
                      </span>
                    </div>
                    <!-- Address -->
                    <div class="guardian-address" style="margin-bottom: var(--space-3);">
                      <i class="ph ph-map-pin"></i>
                      <span>123 Oak Street, San Francisco, CA 94102</span>
                    </div>
                    <!-- Preferences -->
                    <div class="guardian-preferences" style="display: flex; flex-wrap: wrap; gap: var(--space-2);">
                      <span class="badge" style="background: var(--info-50); color: var(--info-600);">
                        <i class="ph ph-receipt" style="margin-right: 4px;"></i>
                        Invoice Recipient
                      </span>
                      <span class="badge" style="background: var(--bg-subtle); color: var(--fg-muted);">
                        <i class="ph ph-envelope" style="margin-right: 4px;"></i>
                        Email Reminders
                      </span>
                      <span class="badge" style="background: var(--bg-subtle); color: var(--fg-muted);">
                        <i class="ph ph-chat-circle" style="margin-right: 4px;"></i>
                        SMS Reminders
                      </span>
                    </div>
                    <div class="guardian-private-note" style="margin-top: var(--space-3); padding: var(--space-2) var(--space-3); background: var(--warning-50); border-radius: var(--radius-sm); font-size: 12px; color: var(--fg-secondary);">
                      <i class="ph ph-lock" style="color: var(--warning-600); margin-right: 4px;"></i>
                      <strong>Private Note:</strong> Prefers to be contacted after 5pm on weekdays.
                    </div>
                  </div>
                  <div class="guardian-actions">
                    <button class="guardian-action-btn" title="Call">
                      <i class="ph ph-phone"></i>
                    </button>
                    <button class="guardian-action-btn" title="Email">
                      <i class="ph ph-envelope"></i>
                    </button>
                    <button class="guardian-action-btn" title="Message">
                      <i class="ph ph-chat-circle"></i>
                    </button>
                  </div>
                </div>
                <div class="contact-edit-mode" style="display: none;">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">First Name <span class="required">*</span></label>
                      <input type="text" class="form-input" value="Jennifer" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Last Name <span class="required">*</span></label>
                      <input type="text" class="form-input" value="Chen" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Title</label>
                      <select class="form-select">
                        <option value="">Select...</option>
                        <option value="mr">Mr.</option>
                        <option value="mrs" selected>Mrs.</option>
                        <option value="ms">Ms.</option>
                        <option value="dr">Dr.</option>
                        <option value="prof">Prof.</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Relationship</label>
                      <select class="form-select" onchange="handleRelationshipChange(this)">
                        <option value="">Select...</option>
                        <option value="mother" selected>Mother</option>
                        <option value="father">Father</option>
                        <option value="stepmother">Stepmother</option>
                        <option value="stepfather">Stepfather</option>
                        <option value="grandmother">Grandmother</option>
                        <option value="grandfather">Grandfather</option>
                        <option value="aunt">Aunt</option>
                        <option value="uncle">Uncle</option>
                        <option value="other">Other</option>
                      </select>
                      <input type="text" class="form-input relationship-other-input" placeholder="Specify..." style="display: none; margin-top: var(--space-2);" />
                    </div>
                    <div class="form-group full-width">
                      <label class="form-label">Email</label>
                      <input type="email" class="form-input" value="jennifer.chen@example.com" />
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Phone Numbers</h5>
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">Mobile Number</label>
                      <div style="display: flex; gap: var(--space-3); align-items: center;">
                        <input type="tel" class="form-input" value="(555) 987-6543" style="flex: 1;" />
                        <label class="checkbox-wrapper" style="white-space: nowrap;">
                          <input type="checkbox" class="checkbox" checked />
                          <span>SMS Capable</span>
                        </label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Home Number</label>
                      <input type="tel" class="form-input" value="(555) 123-4567" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Work Number</label>
                      <input type="tel" class="form-input" value="(555) 999-8888" />
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Address</h5>
                  <div class="form-grid">
                    <div class="form-group full-width">
                      <label class="form-label">Street</label>
                      <input type="text" class="form-input" value="123 Oak Street" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">City</label>
                      <input type="text" class="form-input" value="San Francisco" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">State</label>
                      <select class="form-select">
                        <option value="CA" selected>CA</option>
                        <option value="NY">NY</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Zip</label>
                      <input type="text" class="form-input" value="94102" />
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Preferences</h5>
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" checked />
                        <span>Emergency Contact</span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" checked />
                        <span>Should Receive Invoices</span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" checked />
                        <span>Send Email Reminders</span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" checked />
                        <span>Send SMS Reminders</span>
                      </label>
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Private Note</h5>
                  <div class="form-group">
                    <textarea class="form-textarea" rows="2" placeholder="Add a private note about this contact (only visible to you)...">Prefers to be contacted after 5pm on weekdays.</textarea>
                    <span style="font-size: 11px; color: var(--fg-muted); margin-top: 4px; display: block;">
                      <i class="ph ph-lock" style="margin-right: 4px;"></i>
                      This note is private and not visible to the contact.
                    </span>
                  </div>

                  <div class="form-actions" style="margin-top: var(--space-4);">
                    <button class="btn btn-secondary" onclick="toggleContactEdit('contact-jennifer')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveContactEdit('contact-jennifer')">Save</button>
                  </div>
                </div>
              </div>

              <!-- Secondary Contact -->
              <div class="guardian-card" id="contact-david">
                <div class="contact-view-mode">
                  <div class="guardian-header">
                    <span class="guardian-name">Mr. David Chen</span>
                    <span class="guardian-role" style="margin-left: var(--space-3);">Contact · Father</span>
                    <div class="contact-menu-wrapper">
                      <button class="contact-menu-btn" onclick="toggleContactMenu(this)" title="More options">
                        <i class="ph ph-dots-three-vertical"></i>
                      </button>
                      <div class="contact-menu">
                        <div class="contact-menu-item" onclick="setAsPrimary('David Chen')">
                          <i class="ph ph-star"></i>
                          Set as Primary Contact
                        </div>
                        <div class="contact-menu-item" onclick="toggleEmergencyContact(this)">
                          <i class="ph ph-first-aid-kit"></i>
                          Mark as Emergency Contact
                        </div>
                        <div class="contact-menu-divider"></div>
                        <div class="contact-menu-item contact-menu-item--danger" onclick="showDeleteConfirmation('David Chen')">
                          <i class="ph ph-trash"></i>
                          Delete Contact
                        </div>
                      </div>
                    </div>
                    <button class="btn btn-ghost btn-sm" onclick="toggleContactEdit('contact-david')" style="margin-left: var(--space-2);">
                      <i class="ph ph-pencil"></i>
                      Edit
                    </button>
                  </div>
                  <div class="guardian-contact">
                    <span>
                      <i class="ph ph-envelope"></i>
                      <a href="mailto:david.chen@example.com">david.chen@example.com</a>
                    </span>
                  </div>
                  <!-- Primary phone number (Mobile preferred, else Home) -->
                  <div class="guardian-phone-primary" style="display: flex; align-items: center; gap: var(--space-2); margin-top: var(--space-2); font-size: 13px; color: var(--fg-secondary);">
                    <i class="ph ph-device-mobile" style="color: var(--fg-muted);"></i>
                    <a href="tel:+15559876544" style="color: var(--primary-600); text-decoration: none;">(555) 987-6544</a>
                    <span style="font-size: 11px; color: var(--fg-muted);">Mobile</span>
                    <i class="ph ph-chat-circle" title="SMS Capable" style="color: var(--primary-500); font-size: 14px;"></i>
                  </div>
                  <div class="guardian-details-toggle" style="margin-top: var(--space-3);">
                    <button class="btn-link" onclick="toggleContactDetails('contact-david')" style="background: none; border: none; padding: 0; font-size: 12px; color: var(--primary-600); cursor: pointer; display: flex; align-items: center; gap: var(--space-1);">
                      <i class="ph ph-caret-right details-caret" style="transition: transform var(--transition-fast);"></i>
                      <span class="details-label">Show details</span>
                    </button>
                  </div>
                  <div class="guardian-details" style="display: none; margin-top: var(--space-3); padding-top: var(--space-3); border-top: 1px solid var(--border-default);">
                    <!-- Additional phone numbers -->
                    <div class="guardian-phone-list" style="display: flex; flex-direction: column; gap: var(--space-2); margin-bottom: var(--space-3);">
                      <span class="guardian-phone-item" style="display: flex; align-items: center; gap: var(--space-2); font-size: 13px; color: var(--fg-secondary);">
                        <i class="ph ph-briefcase" style="color: var(--fg-muted);"></i>
                        <a href="tel:+15557776666" style="color: var(--primary-600); text-decoration: none;">(555) 777-6666</a>
                        <span style="font-size: 11px; color: var(--fg-muted);">Work</span>
                      </span>
                    </div>
                    <!-- Address -->
                    <div class="guardian-address" style="margin-bottom: var(--space-3);">
                      <i class="ph ph-map-pin"></i>
                      <span>123 Oak Street, San Francisco, CA 94102 <span class="address-note">(same as Jennifer)</span></span>
                    </div>
                    <!-- Preferences -->
                    <div class="guardian-preferences" style="display: flex; flex-wrap: wrap; gap: var(--space-2);">
                      <span class="badge" style="background: var(--bg-subtle); color: var(--fg-muted);">
                        <i class="ph ph-envelope" style="margin-right: 4px;"></i>
                        Email Reminders
                      </span>
                    </div>
                  </div>
                  <div class="guardian-actions">
                    <button class="guardian-action-btn" title="Call">
                      <i class="ph ph-phone"></i>
                    </button>
                    <button class="guardian-action-btn" title="Email">
                      <i class="ph ph-envelope"></i>
                    </button>
                    <button class="guardian-action-btn" title="Message">
                      <i class="ph ph-chat-circle"></i>
                    </button>
                  </div>
                </div>
                <div class="contact-edit-mode" style="display: none;">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">First Name <span class="required">*</span></label>
                      <input type="text" class="form-input" value="David" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Last Name <span class="required">*</span></label>
                      <input type="text" class="form-input" value="Chen" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Title</label>
                      <select class="form-select">
                        <option value="">Select...</option>
                        <option value="mr" selected>Mr.</option>
                        <option value="mrs">Mrs.</option>
                        <option value="ms">Ms.</option>
                        <option value="dr">Dr.</option>
                        <option value="prof">Prof.</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Relationship</label>
                      <select class="form-select" onchange="handleRelationshipChange(this)">
                        <option value="">Select...</option>
                        <option value="mother">Mother</option>
                        <option value="father" selected>Father</option>
                        <option value="stepmother">Stepmother</option>
                        <option value="stepfather">Stepfather</option>
                        <option value="grandmother">Grandmother</option>
                        <option value="grandfather">Grandfather</option>
                        <option value="aunt">Aunt</option>
                        <option value="uncle">Uncle</option>
                        <option value="other">Other</option>
                      </select>
                      <input type="text" class="form-input relationship-other-input" placeholder="Specify..." style="display: none; margin-top: var(--space-2);" />
                    </div>
                    <div class="form-group full-width">
                      <label class="form-label">Email</label>
                      <input type="email" class="form-input" value="david.chen@example.com" />
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Phone Numbers</h5>
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">Mobile Number</label>
                      <div style="display: flex; gap: var(--space-3); align-items: center;">
                        <input type="tel" class="form-input" value="(555) 987-6544" style="flex: 1;" />
                        <label class="checkbox-wrapper" style="white-space: nowrap;">
                          <input type="checkbox" class="checkbox" checked />
                          <span>SMS Capable</span>
                        </label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Home Number</label>
                      <input type="tel" class="form-input" placeholder="Enter home number" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">Work Number</label>
                      <input type="tel" class="form-input" value="(555) 777-6666" />
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Address</h5>
                  <div class="form-group" style="margin-bottom: var(--space-3);">
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox" checked onchange="toggleSameAsAddress(this, 'contact-david')" />
                      <span>Same as primary contact</span>
                    </label>
                  </div>
                  <div class="form-grid contact-address-fields" style="display: none;">
                    <div class="form-group full-width">
                      <label class="form-label">Street</label>
                      <input type="text" class="form-input" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">City</label>
                      <input type="text" class="form-input" />
                    </div>
                    <div class="form-group">
                      <label class="form-label">State</label>
                      <select class="form-select">
                        <option value="">Select...</option>
                        <option value="CA">CA</option>
                        <option value="NY">NY</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Zip</label>
                      <input type="text" class="form-input" />
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Preferences</h5>
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" />
                        <span>Set as Primary Contact</span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" />
                        <span>Emergency Contact</span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" />
                        <span>Should Receive Invoices</span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" checked />
                        <span>Send Email Reminders</span>
                      </label>
                    </div>
                    <div class="form-group">
                      <label class="checkbox-wrapper">
                        <input type="checkbox" class="checkbox" />
                        <span>Send SMS Reminders</span>
                      </label>
                    </div>
                  </div>

                  <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Private Note</h5>
                  <div class="form-group">
                    <textarea class="form-textarea" rows="2" placeholder="Add a private note about this contact (only visible to you)..."></textarea>
                    <span style="font-size: 11px; color: var(--fg-muted); margin-top: 4px; display: block;">
                      <i class="ph ph-lock" style="margin-right: 4px;"></i>
                      This note is private and not visible to the contact.
                    </span>
                  </div>

                  <div class="form-actions" style="margin-top: var(--space-4);">
                    <button class="btn btn-secondary" onclick="toggleContactEdit('contact-david')">Cancel</button>
                    <button class="btn btn-primary" onclick="saveContactEdit('contact-david')">Save</button>
                  </div>
                </div>
              </div>

              <!-- Add Contact Button -->
              <button class="add-contact-btn" id="addContactBtn" onclick="showAddContactForm()">
                <i class="ph ph-plus"></i>
                Add Contact
              </button>

              <!-- Add Contact Inline Form (hidden by default) -->
              <div class="guardian-card" id="addContactCard" style="display: none; border: 2px dashed var(--primary-300); background: var(--primary-50);">
                <div class="guardian-header" style="border-bottom: 1px solid var(--primary-200); padding-bottom: var(--space-3); margin-bottom: var(--space-3);">
                  <span class="guardian-name" style="color: var(--primary-700);">
                    <i class="ph ph-user-plus" style="margin-right: var(--space-2);"></i>
                    New Contact
                  </span>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">First Name <span class="required">*</span></label>
                    <input type="text" class="form-input" id="newContactFirstName" placeholder="Enter first name" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Last Name <span class="required">*</span></label>
                    <input type="text" class="form-input" id="newContactLastName" placeholder="Enter last name" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Title</label>
                    <select class="form-select" id="newContactTitle">
                      <option value="">Select...</option>
                      <option value="mr">Mr.</option>
                      <option value="mrs">Mrs.</option>
                      <option value="ms">Ms.</option>
                      <option value="dr">Dr.</option>
                      <option value="prof">Prof.</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Relationship</label>
                    <select class="form-select" onchange="handleRelationshipChange(this)">
                      <option value="">Select relationship...</option>
                      <option value="mother">Mother</option>
                      <option value="father">Father</option>
                      <option value="stepmother">Stepmother</option>
                      <option value="stepfather">Stepfather</option>
                      <option value="grandmother">Grandmother</option>
                      <option value="grandfather">Grandfather</option>
                      <option value="aunt">Aunt</option>
                      <option value="uncle">Uncle</option>
                      <option value="sibling">Sibling</option>
                      <option value="foster-parent">Foster Parent</option>
                      <option value="other">Other</option>
                    </select>
                    <input type="text" class="form-input relationship-other-input" placeholder="Specify relationship..." style="display: none; margin-top: var(--space-2);" />
                  </div>
                  <div class="form-group full-width">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" placeholder="Enter email address" />
                    <span style="font-size: 11px; color: var(--fg-muted); margin-top: 4px; display: block;">At least email or mobile number is required</span>
                  </div>
                </div>

                <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Phone Numbers</h5>
                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">Mobile Number</label>
                    <div style="display: flex; gap: var(--space-3); align-items: center;">
                      <input type="tel" class="form-input" placeholder="Enter mobile number" style="flex: 1;" />
                      <label class="checkbox-wrapper" style="white-space: nowrap;">
                        <input type="checkbox" class="checkbox" />
                        <span>SMS Capable</span>
                      </label>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Home Number</label>
                    <input type="tel" class="form-input" placeholder="Enter home number" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Work Number</label>
                    <input type="tel" class="form-input" placeholder="Enter work number" />
                  </div>
                </div>

                <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Address</h5>
                <div class="form-group" style="margin-bottom: var(--space-3);">
                  <label class="checkbox-wrapper">
                    <input type="checkbox" class="checkbox" id="newContactSameAddress" checked onchange="toggleNewContactAddress()" />
                    <span>Same as primary contact</span>
                  </label>
                </div>
                <div class="form-grid" id="newContactAddressFields" style="display: none;">
                  <div class="form-group full-width">
                    <label class="form-label">Street Address</label>
                    <input type="text" class="form-input" placeholder="Enter street address" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">City</label>
                    <input type="text" class="form-input" placeholder="Enter city" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">State</label>
                    <select class="form-select">
                      <option value="">Select state...</option>
                      <option value="CA">California</option>
                      <option value="NY">New York</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Zip Code</label>
                    <input type="text" class="form-input" placeholder="Enter zip" />
                  </div>
                </div>

                <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Preferences</h5>
                <div class="form-grid">
                  <div class="form-group">
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox" />
                      <span>Set as Primary Contact</span>
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox" />
                      <span>Emergency Contact</span>
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox" />
                      <span>Should Receive Invoices</span>
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox" />
                      <span>Send Email Reminders</span>
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-wrapper">
                      <input type="checkbox" class="checkbox" />
                      <span>Send SMS Reminders</span>
                    </label>
                  </div>
                </div>

                <h5 style="font-size: 12px; font-weight: 500; color: var(--fg-muted); margin: var(--space-4) 0 var(--space-3);">Private Note</h5>
                <div class="form-group">
                  <textarea class="form-textarea" rows="2" placeholder="Add a private note about this contact (only visible to you)..."></textarea>
                  <span style="font-size: 11px; color: var(--fg-muted); margin-top: 4px; display: block;">
                    <i class="ph ph-lock" style="margin-right: 4px;"></i>
                    This note is private and not visible to the contact.
                  </span>
                </div>

                <div class="form-actions" style="margin-top: var(--space-4);">
                  <button class="btn btn-secondary" onclick="hideAddContactForm()">Cancel</button>
                  <button class="btn btn-primary" onclick="saveNewContact()">Add Contact</button>
                </div>
              </div>

                <div class="siblings-section">
                  <div class="siblings-title">Other Students in Family</div>
                  <div class="sibling-item">
                    <a href="#" class="sibling-name">Michael Chen</a>
                    <span class="badge badge-active">Active</span>
                  </div>
                </div>

                <!-- Billing Indicator -->
                <div class="billing-indicator" style="margin-top: var(--space-4); padding-top: var(--space-4); border-top: 1px solid var(--border-default);">
                  <div style="display: flex; align-items: center; gap: var(--space-2); font-size: 13px;">
                    <span style="color: var(--fg-secondary);">$50/lesson</span>
                    <span style="color: var(--fg-faint);">·</span>
                    <span style="color: var(--success-600);">$50 credit</span>
                    <span style="color: var(--fg-faint);">·</span>
                    <a href="student-detail-invoices.html" style="color: var(--primary-600); text-decoration: none; display: inline-flex; align-items: center; gap: 4px;">
                      View billing
                      <i class="ph ph-arrow-right" style="font-size: 12px;"></i>
                    </a>
                  </div>
                </div>
            </div>
          </section>

          <!-- Notes Section -->
          <section class="section-card section-card--secondary" id="notesSection">
            <div class="section-header">
              <h2 class="section-title">Notes</h2>
            </div>
            <div class="section-content">
              <!-- Quick Add -->
              <div class="quick-add-note">
                <textarea class="quick-add-input" placeholder="Add a quick note..." id="quickNoteInput" rows="1" onkeydown="handleNoteKeydown(event)"></textarea>
                <div class="quick-add-actions">
                  <button class="btn btn-secondary" onclick="clearQuickNote()">Cancel</button>
                  <button class="btn btn-primary" onclick="addQuickNote()">Add Note</button>
                </div>
              </div>

              <!-- Pinned Note -->
              <div class="pinned-note" id="pinnedNote">
                <div class="pinned-note-header">
                  <span class="pinned-note-label">
                    <i class="ph ph-push-pin"></i>
                    Pinned
                  </span>
                </div>
                <div class="pinned-note-content">
                  Responds well to positive reinforcement. Enjoys learning about historical context of pieces. Has mild performance anxiety - needs extra encouragement before recitals.
                </div>
                <div class="pinned-note-actions">
                  <button class="note-action-btn" title="Edit" onclick="editNote('pinned')">
                    <i class="ph ph-pencil"></i>
                  </button>
                  <button class="note-action-btn" title="Unpin" onclick="unpinNote()">
                    <i class="ph ph-push-pin-slash"></i>
                  </button>
                </div>
              </div>

              <!-- Notes List -->
              <div class="notes-list-header">
                <span class="notes-list-title">Recent Notes</span>
              </div>
              <div class="notes-list" id="notesList">
                <div class="note-entry" data-note-id="1">
                  <div class="note-entry-content">
                    Making great progress on dynamics in Chopin Nocturne. Ready to start working on the coda section next lesson.
                  </div>
                  <div class="note-entry-meta">
                    <span>Jan 6</span>
                  </div>
                  <div class="note-entry-actions">
                    <button class="note-action-btn" title="Pin" onclick="pinNote(1)">
                      <i class="ph ph-push-pin"></i>
                    </button>
                    <button class="note-action-btn" title="Edit" onclick="editNote(1)">
                      <i class="ph ph-pencil"></i>
                    </button>
                    <button class="note-action-btn note-action-btn--danger" title="Delete" onclick="deleteNote(1)">
                      <i class="ph ph-trash"></i>
                    </button>
                  </div>
                </div>

                <div class="note-entry" data-note-id="2">
                  <div class="note-entry-content">
                    Struggled with left hand crossovers in measures 24-32. Assigned Hanon exercises #12-15 for strength building.
                  </div>
                  <div class="note-entry-meta">
                    <span>Dec 20</span>
                  </div>
                  <div class="note-entry-actions">
                    <button class="note-action-btn" title="Pin" onclick="pinNote(2)">
                      <i class="ph ph-push-pin"></i>
                    </button>
                    <button class="note-action-btn" title="Edit" onclick="editNote(2)">
                      <i class="ph ph-pencil"></i>
                    </button>
                    <button class="note-action-btn note-action-btn--danger" title="Delete" onclick="deleteNote(2)">
                      <i class="ph ph-trash"></i>
                    </button>
                  </div>
                </div>

                <div class="note-entry" data-note-id="3">
                  <div class="note-entry-content">
                    Preparing for spring recital in March. Selected Chopin's Nocturne Op. 9 No. 2 as performance piece.
                  </div>
                  <div class="note-entry-meta">
                    <span>Dec 13</span>
                  </div>
                  <div class="note-entry-actions">
                    <button class="note-action-btn" title="Pin" onclick="pinNote(3)">
                      <i class="ph ph-push-pin"></i>
                    </button>
                    <button class="note-action-btn" title="Edit" onclick="editNote(3)">
                      <i class="ph ph-pencil"></i>
                    </button>
                    <button class="note-action-btn note-action-btn--danger" title="Delete" onclick="deleteNote(3)">
                      <i class="ph ph-trash"></i>
                    </button>
                  </div>
                </div>

                <div class="note-entry" data-note-id="4">
                  <div class="note-entry-content">
                    Focus areas identified: dynamics/expression, pedaling technique, performance confidence.
                  </div>
                  <div class="note-entry-meta">
                    <span>Dec 6</span>
                  </div>
                  <div class="note-entry-actions">
                    <button class="note-action-btn" title="Pin" onclick="pinNote(4)">
                      <i class="ph ph-push-pin"></i>
                    </button>
                    <button class="note-action-btn" title="Edit" onclick="editNote(4)">
                      <i class="ph ph-pencil"></i>
                    </button>
                    <button class="note-action-btn note-action-btn--danger" title="Delete" onclick="deleteNote(4)">
                      <i class="ph ph-trash"></i>
                    </button>
                  </div>
                </div>
              </div>

              <button class="show-all-notes" onclick="showAllNotes()">
                Show all 8 notes
                <i class="ph ph-caret-down"></i>
              </button>
            </div>
          </section>

          <!-- Personal Details Section (Collapsed by default) -->
          <section class="section-card section-card--secondary section-card--collapsed" id="personalDetailsSection">
            <div class="section-header">
              <h2 class="section-title">Personal Details</h2>
              <div class="section-header-actions">
                <button class="btn btn-ghost" onclick="toggleEdit('personalDetailsSection')">
                  <i class="ph ph-pencil"></i>
                  Edit
                </button>
                <button class="btn btn-ghost" onclick="toggleCollapse('personalDetailsSection')">
                  <i class="ph ph-caret-down"></i>
                </button>
              </div>
            </div>
            <div class="collapsed-summary">
              <span class="collapsed-summary-text">Female, 14 years old, Lincoln Middle School</span>
              <a href="#" class="collapsed-summary-link" onclick="toggleCollapse('personalDetailsSection'); return false;">View details</a>
            </div>
            <div class="section-content">
              <div class="view-mode">
                <div class="data-grid">
                  <div class="data-item">
                    <span class="data-label">First Name</span>
                    <span class="data-value">Emily</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Last Name</span>
                    <span class="data-value">Chen</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Student Type</span>
                    <span class="data-value"><span class="badge badge-type">Child</span></span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Status</span>
                    <span class="data-value"><span class="badge badge-active">Active</span></span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Gender</span>
                    <span class="data-value">Female</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Birthday</span>
                    <span class="data-value">March 15, 2010 (14 years old)</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">School</span>
                    <span class="data-value">Lincoln Middle School</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Referrer</span>
                    <span class="data-value">Maria Thompson</span>
                  </div>
                  <div class="data-item">
                    <span class="data-label">Student Since</span>
                    <span class="data-value">September 2024</span>
                  </div>
                </div>
              </div>

              <div class="edit-form">
                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">First Name <span class="required">*</span></label>
                    <input type="text" class="form-input" value="Emily" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Last Name <span class="required">*</span></label>
                    <input type="text" class="form-input" value="Chen" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Student Type <span class="required">*</span></label>
                    <select class="form-select">
                      <option value="child" selected>Child</option>
                      <option value="adult">Adult</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Status <span class="required">*</span></label>
                    <select class="form-select">
                      <option value="active" selected>Active</option>
                      <option value="trial">Trial</option>
                      <option value="waiting">Waiting</option>
                      <option value="lead">Lead</option>
                      <option value="inactive">Inactive</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select class="form-select">
                      <option value="">Select...</option>
                      <option value="male">Male</option>
                      <option value="female" selected>Female</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Birthday</label>
                    <input type="date" class="form-input" value="2010-03-15" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">School</label>
                    <input type="text" class="form-input" value="Lincoln Middle School" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Referrer</label>
                    <input type="text" class="form-input" value="Maria Thompson" />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Student Since</label>
                    <input type="month" class="form-input" value="2024-09" />
                  </div>
                </div>
                <div class="form-actions">
                  <button class="btn btn-secondary" onclick="cancelEdit('personalDetailsSection')">Cancel</button>
                  <button class="btn btn-primary" onclick="saveEdit('personalDetailsSection')">Save Changes</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Recent Lessons Section -->
          <section class="section-card section-card--secondary">
            <div class="section-header">
              <h2 class="section-title">Recent Lessons</h2>
              <a href="student-detail-lessons.html" class="view-all-link">
                View All
                <i class="ph ph-arrow-right"></i>
              </a>
            </div>
            <div class="section-content">
              <table class="lessons-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Duration</th>
                    <th>Status</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Mon, Jan 6</td>
                    <td>3:00 - 3:30 PM</td>
                    <td>30 min</td>
                    <td><span class="lesson-status lesson-status--attended">Attended</span></td>
                    <td><span class="lesson-note">Worked on Chopin Nocturne Op. 9</span></td>
                  </tr>
                  <tr>
                    <td>Fri, Jan 3</td>
                    <td>3:00 - 3:30 PM</td>
                    <td>30 min</td>
                    <td><span class="lesson-status lesson-status--attended">Attended</span></td>
                    <td><span class="lesson-note">Review of scales and arpeggios</span></td>
                  </tr>
                  <tr>
                    <td>Mon, Dec 30</td>
                    <td>3:00 - 3:30 PM</td>
                    <td>30 min</td>
                    <td><span class="lesson-status lesson-status--cancelled">Cancelled</span></td>
                    <td><span class="lesson-note">Holiday break</span></td>
                  </tr>
                  <tr>
                    <td>Fri, Dec 27</td>
                    <td>3:00 - 3:30 PM</td>
                    <td>30 min</td>
                    <td><span class="lesson-status lesson-status--attended">Attended</span></td>
                    <td><span class="lesson-note">Prepared for winter recital</span></td>
                  </tr>
                  <tr>
                    <td>Mon, Dec 23</td>
                    <td>3:00 - 3:30 PM</td>
                    <td>30 min</td>
                    <td><span class="lesson-status lesson-status--attended">Attended</span></td>
                    <td><span class="lesson-note">Final recital practice</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>
      </main>
    </div>

    <script>
      // Actions Dropdown
      function toggleActionsMenu() {
        const menu = document.getElementById('actionsMenu');
        menu.classList.toggle('active');
      }

      // Close dropdown when clicking outside
      document.addEventListener('click', function(event) {
        const dropdown = document.querySelector('.dropdown');
        const menu = document.getElementById('actionsMenu');
        if (!dropdown.contains(event.target)) {
          menu.classList.remove('active');
        }
      });

      // Student Type Toggle (Adult vs Child)
      function toggleStudentType() {
        const isAdult = document.getElementById('adultStudentToggle').checked;
        const familySection = document.getElementById('familySection');
        const adultOnlyElements = document.querySelectorAll('.adult-only');
        const familyLink = document.querySelector('.student-family');

        if (isAdult) {
          if (familySection) familySection.style.display = 'none';
          adultOnlyElements.forEach(el => el.style.display = 'block');
          if (familyLink) familyLink.style.display = 'none';
        } else {
          if (familySection) familySection.style.display = 'block';
          adultOnlyElements.forEach(el => el.style.display = 'none');
          if (familyLink) familyLink.style.display = 'flex';
        }
      }

      // Edit Mode Toggle
      function toggleEdit(sectionId) {
        const section = document.getElementById(sectionId);
        if (section.classList.contains('section-card--collapsed')) {
          section.classList.remove('section-card--collapsed');
        }
        section.classList.add('editing');
      }

      function cancelEdit(sectionId) {
        const section = document.getElementById(sectionId);
        section.classList.remove('editing');
      }

      function saveEdit(sectionId) {
        const section = document.getElementById(sectionId);
        section.classList.remove('editing');
        alert('Changes saved successfully!');
      }

      // Collapse Toggle
      function toggleCollapse(sectionId) {
        const section = document.getElementById(sectionId);
        section.classList.toggle('section-card--collapsed');
        const caret = section.querySelector('.section-header .ph-caret-down, .section-header .ph-caret-up');
        if (caret) {
          if (section.classList.contains('section-card--collapsed')) {
            caret.classList.remove('ph-caret-up');
            caret.classList.add('ph-caret-down');
          } else {
            caret.classList.remove('ph-caret-down');
            caret.classList.add('ph-caret-up');
          }
        }
      }

      // Pre-lesson toggle
      function togglePrelesson() {
        const content = document.getElementById('prelessonContent');
        const btn = document.querySelector('.prelesson-header button i');
        if (content.style.display === 'none') {
          content.style.display = 'block';
          btn.classList.remove('ph-caret-down');
          btn.classList.add('ph-caret-up');
        } else {
          content.style.display = 'none';
          btn.classList.remove('ph-caret-up');
          btn.classList.add('ph-caret-down');
        }
      }

      // Notes Functions
      function handleNoteKeydown(event) {
        if (event.key === 'Enter' && (event.metaKey || event.ctrlKey)) {
          event.preventDefault();
          addQuickNote();
        }
        if (event.key === 'Escape') {
          clearQuickNote();
          event.target.blur();
        }
      }

      function clearQuickNote() {
        const input = document.getElementById('quickNoteInput');
        input.value = '';
        input.blur();
      }

      function addQuickNote() {
        const input = document.getElementById('quickNoteInput');
        const noteText = input.value.trim();
        if (!noteText) return;

        const notesList = document.getElementById('notesList');
        const today = new Date();
        const dateStr = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

        const newNote = document.createElement('div');
        newNote.className = 'note-entry';
        newNote.dataset.noteId = Date.now();
        newNote.innerHTML = `
          <div class="note-entry-content">${noteText}</div>
          <div class="note-entry-meta"><span>${dateStr}</span></div>
          <div class="note-entry-actions">
            <button class="note-action-btn" title="Pin" onclick="pinNote(${Date.now()})"><i class="ph ph-push-pin"></i></button>
            <button class="note-action-btn" title="Edit" onclick="editNote(${Date.now()})"><i class="ph ph-pencil"></i></button>
            <button class="note-action-btn note-action-btn--danger" title="Delete" onclick="deleteNote(${Date.now()})"><i class="ph ph-trash"></i></button>
          </div>
        `;

        notesList.insertBefore(newNote, notesList.firstChild);
        input.value = '';

        newNote.style.background = 'var(--primary-50)';
        setTimeout(() => { newNote.style.background = ''; }, 1000);
      }

      function editNote(noteId) {
        const noteEntry = noteId === 'pinned'
          ? document.getElementById('pinnedNote')
          : document.querySelector(`[data-note-id="${noteId}"]`);
        const contentEl = noteEntry.querySelector('.note-entry-content, .pinned-note-content');
        const currentText = contentEl.textContent.trim();

        const input = document.createElement('textarea');
        input.className = 'form-textarea';
        input.value = currentText;
        input.style.width = '100%';
        input.style.minHeight = '80px';
        input.style.marginBottom = 'var(--space-2)';
        input.style.boxSizing = 'border-box';

        const actions = document.createElement('div');
        actions.style.display = 'flex';
        actions.style.gap = 'var(--space-2)';
        actions.style.justifyContent = 'flex-end';
        actions.innerHTML = `
          <button class="btn btn-secondary btn-sm" onclick="cancelNoteEdit(this, '${currentText}')">Cancel</button>
          <button class="btn btn-primary btn-sm" onclick="saveNoteEdit(this)">Save</button>
        `;

        contentEl.innerHTML = '';
        contentEl.appendChild(input);
        contentEl.appendChild(actions);
        input.focus();
      }

      function cancelNoteEdit(btn, originalText) {
        const contentEl = btn.closest('.note-entry-content, .pinned-note-content');
        contentEl.innerHTML = originalText;
      }

      function saveNoteEdit(btn) {
        const contentEl = btn.closest('.note-entry-content, .pinned-note-content');
        const textarea = contentEl.querySelector('textarea');
        const newText = textarea.value.trim();
        contentEl.innerHTML = newText;
      }

      function deleteNote(noteId) {
        if (confirm('Delete this note?')) {
          const noteEntry = document.querySelector(`[data-note-id="${noteId}"]`);
          noteEntry.style.opacity = '0';
          noteEntry.style.transform = 'translateX(20px)';
          noteEntry.style.transition = 'all 0.2s ease';
          setTimeout(() => { noteEntry.remove(); }, 200);
        }
      }

      function pinNote(noteId) {
        const noteEntry = document.querySelector(`[data-note-id="${noteId}"]`);
        const pinnedNote = document.getElementById('pinnedNote');
        const noteContent = noteEntry.querySelector('.note-entry-content').textContent.trim();
        const currentPinnedContent = pinnedNote.querySelector('.pinned-note-content').textContent.trim();

        pinnedNote.querySelector('.pinned-note-content').textContent = noteContent;

        if (currentPinnedContent) {
          const notesList = document.getElementById('notesList');
          const today = new Date();
          const dateStr = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

          const newNote = document.createElement('div');
          newNote.className = 'note-entry';
          newNote.dataset.noteId = Date.now();
          newNote.innerHTML = `
            <div class="note-entry-content">${currentPinnedContent}</div>
            <div class="note-entry-meta"><span>${dateStr}</span></div>
            <div class="note-entry-actions">
              <button class="note-action-btn" title="Pin" onclick="pinNote(${Date.now()})"><i class="ph ph-push-pin"></i></button>
              <button class="note-action-btn" title="Edit" onclick="editNote(${Date.now()})"><i class="ph ph-pencil"></i></button>
              <button class="note-action-btn note-action-btn--danger" title="Delete" onclick="deleteNote(${Date.now()})"><i class="ph ph-trash"></i></button>
            </div>
          `;
          notesList.insertBefore(newNote, notesList.firstChild);
        }

        noteEntry.remove();
        pinnedNote.style.display = 'block';
      }

      function unpinNote() {
        const pinnedNote = document.getElementById('pinnedNote');
        const pinnedContent = pinnedNote.querySelector('.pinned-note-content').textContent.trim();

        const notesList = document.getElementById('notesList');
        const today = new Date();
        const dateStr = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

        const newNote = document.createElement('div');
        newNote.className = 'note-entry';
        newNote.dataset.noteId = Date.now();
        newNote.innerHTML = `
          <div class="note-entry-content">${pinnedContent}</div>
          <div class="note-entry-meta"><span>${dateStr}</span></div>
          <div class="note-entry-actions">
            <button class="note-action-btn" title="Pin" onclick="pinNote(${Date.now()})"><i class="ph ph-push-pin"></i></button>
            <button class="note-action-btn" title="Edit" onclick="editNote(${Date.now()})"><i class="ph ph-pencil"></i></button>
            <button class="note-action-btn note-action-btn--danger" title="Delete" onclick="deleteNote(${Date.now()})"><i class="ph ph-trash"></i></button>
          </div>
        `;
        notesList.insertBefore(newNote, notesList.firstChild);
        pinnedNote.style.display = 'none';
      }

      function showAllNotes() {
        alert('This would open a modal or expand to show all 8 notes');
      }

      function editStudent() {
        document.getElementById('actionsMenu').classList.remove('active');
        toggleEdit('personalDetailsSection');
        document.getElementById('personalDetailsSection').scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      // Contact Menu Toggle
      function toggleContactMenu(btn) {
        const menu = btn.nextElementSibling;
        const isActive = menu.classList.contains('active');
        document.querySelectorAll('.contact-menu').forEach(m => m.classList.remove('active'));
        if (!isActive) { menu.classList.add('active'); }
      }

      document.addEventListener('click', function(event) {
        if (!event.target.closest('.contact-menu-wrapper')) {
          document.querySelectorAll('.contact-menu').forEach(m => m.classList.remove('active'));
        }
      });

      function setAsPrimary(name) {
        document.querySelectorAll('.contact-menu').forEach(m => m.classList.remove('active'));
        alert(name + ' has been set as the Primary Contact.');
      }

      function toggleEmergencyContact(menuItem) {
        document.querySelectorAll('.contact-menu').forEach(m => m.classList.remove('active'));
        alert('Emergency contact status toggled.');
      }

      function showDeleteConfirmation(name) {
        document.querySelectorAll('.contact-menu').forEach(m => m.classList.remove('active'));
        document.getElementById('deleteContactName').textContent = name;
        document.getElementById('deleteConfirmModal').classList.add('active');
      }

      function toggleContactEdit(contactId) {
        const card = document.getElementById(contactId);
        const viewMode = card.querySelector('.contact-view-mode');
        const editMode = card.querySelector('.contact-edit-mode');
        if (editMode.style.display === 'none') {
          viewMode.style.display = 'none';
          editMode.style.display = 'block';
          editMode.querySelector('input').focus();
        } else {
          viewMode.style.display = 'block';
          editMode.style.display = 'none';
        }
      }

      function toggleContactDetails(contactId) {
        const card = document.getElementById(contactId);
        const details = card.querySelector('.guardian-details');
        const toggle = card.querySelector('.guardian-details-toggle');
        const caret = toggle.querySelector('.details-caret');
        const label = toggle.querySelector('.details-label');

        if (details.style.display === 'none') {
          details.style.display = 'block';
          caret.style.transform = 'rotate(90deg)';
          label.textContent = 'Hide details';
        } else {
          details.style.display = 'none';
          caret.style.transform = 'rotate(0deg)';
          label.textContent = 'Show details';
        }
      }

      function saveContactEdit(contactId) {
        toggleContactEdit(contactId);
        alert('Contact updated successfully!');
      }

      function toggleSameAsAddress(checkbox, contactId) {
        const card = document.getElementById(contactId);
        const addressFields = card.querySelector('.contact-address-fields');
        addressFields.style.display = checkbox.checked ? 'none' : 'grid';
      }

      function hideDeleteConfirmation() {
        document.getElementById('deleteConfirmModal').classList.remove('active');
      }

      function confirmDeleteContact() {
        hideDeleteConfirmation();
        alert('Contact deleted successfully.');
      }

      function handleRelationshipChange(select) {
        const otherInput = select.parentElement.querySelector('.relationship-other-input');
        otherInput.style.display = select.value === 'other' ? 'block' : 'none';
      }

      function showAddContactForm() {
        const card = document.getElementById('addContactCard');
        const btn = document.getElementById('addContactBtn');
        card.style.display = 'block';
        btn.style.display = 'none';
        setTimeout(() => { document.getElementById('newContactFirstName').focus(); }, 100);
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      function hideAddContactForm() {
        const card = document.getElementById('addContactCard');
        const btn = document.getElementById('addContactBtn');
        card.style.display = 'none';
        btn.style.display = 'flex';
        clearAddContactForm();
      }

      function clearAddContactForm() {
        const card = document.getElementById('addContactCard');
        card.querySelectorAll('input').forEach(input => {
          if (input.type === 'checkbox') {
            input.checked = input.id === 'newContactSameAddress';
          } else {
            input.value = '';
          }
        });
        card.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
        card.querySelectorAll('.relationship-other-input').forEach(input => input.style.display = 'none');
        document.getElementById('newContactAddressFields').style.display = 'none';
      }

      function toggleNewContactAddress() {
        const checkbox = document.getElementById('newContactSameAddress');
        const addressFields = document.getElementById('newContactAddressFields');
        addressFields.style.display = checkbox.checked ? 'none' : 'grid';
      }

      function saveNewContact() {
        hideAddContactForm();
        alert('Contact added successfully!');
      }

      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          const card = document.getElementById('addContactCard');
          if (card && card.style.display !== 'none') {
            hideAddContactForm();
          }
        }
      });
    </script>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteConfirmModal">
      <div class="modal">
        <h3 class="modal-title">Delete Contact</h3>
        <p class="modal-body">
          Are you sure you want to remove <strong id="deleteContactName">David Chen</strong> as a contact?
          This action cannot be undone.
        </p>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="hideDeleteConfirmation()">Cancel</button>
          <button class="btn btn-danger" onclick="confirmDeleteContact()">Delete Contact</button>
        </div>
      </div>
    </div>

  </body>
</html>
